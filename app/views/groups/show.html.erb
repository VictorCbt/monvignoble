<body class="body-investment">


<div class="card-category" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(https://images.pexels.com/photos/442116/pexels-photo-442116.jpeg?cs=srgb&dl=clouds-countryside-cropland-crops-442116.jpg&fm=jpg)">
  <%= @group.name %> (<%= @group.region %>)
</div>

<div class="container">
  <div class="d-flex">
    <div class="group-block w-50">
      <div class="group-title">
        <h2 class='title'>Votre projet d'investissement</h2>
        <div class="card-offre-button">
          <div class="btn btn-primary">
            <%= link_to "Mettre à jour", edit_group_path(@group) %>
          </div>
        </div>
      </div>
      <div class="card-body">
        <p>Région viticole : <%= @group.region %></p>
        <p>Appellation : <%= @group.designation %></p>
        <p>Profil du vigneron : <%= @group.winemaker_profile %></p>
        <p>Accepte les rétributions différées : <%= @group.deferred_remuneration %></p>
        <p>Services proposés par le vigneron : <%= @group.services %></p>
        <p>Parts disponibles : <%= @group.share_available %></p>
        <p>Montant total de l'investissement : <%= @group.investment_total %></p>
        <p>Montant du ticket d'entrée : <%= @group.ticket_amount %></p>
      </div>
    </div>
    <div class="group-block w-50">
      <div class="btn btn-info">
        <%= link_to "Paramétrer le groupe", root_path %>
      </div>
      <br>
      <div class="btn btn-info">
        <%= link_to "Partager le lien du groupe", root_path %>
      </div>
      <br>
      <div class="btn btn-info">
        <%= link_to "Valider une demande d'intérêt", root_path %>
      </div>
      <br>
      <div class="btn btn-info">
        <%= link_to "Demander l'avis à l'un de nos experts", root_path %>
      </div>
    </div>
  </div>

  <div class="group-block w-100">
    <h2 class='group-title'>Top 10 des investissements disponibles par rapport à votre projet d'investissement</h2>
    <div class="cards-top">
       <% @investments.each do |investment| %>
        <div class="card-top">
          <div>
            <%= cl_image_tag investment.photo.key, height: 100, width: 150, crop: :fill if investment.photo.attached? %>
          </div>
          <div class="card-top-infos">
            <div class="card-top-text">
              <h2><%= investment.investment_name %></h2>
              <p><%= investment.region %></p>
              <p><%= investment.designation %></p>
            </div>
          </div>
          <div class="card-top-pricing">
            <h2>Ticket : <%= investment.ticket_amount %> €</h2>
            <h2>Inv total : <%= investment.investment_total %> €</h2>
          </div>
          <div>
            <svg viewBox="0 0 161 301" style="height: 100px" data-size="<%= investment.match / 100.0 %>">
              <clipPath id="wine-clippath">
              <path d="M80.125,138.75c-5.973,0 -12.822,-1.152 -19.834,-3.387l-0.166,-0.053c-6.667,-2.123 -13.482,-5.221 -19.849,-9.235l-0.151,-0.095c-16.52,-10.43 -30,-26.96 -30,-48.48c0,-12.61 7.5,-38.75 16.47,-56.25l106.64,0c9.01,17.75 16.89,43.64 16.89,56.25c0,38.585 -44.017,61.162 -69.848,61.25l-0.152,0Z" fill="#000"></path>
              </clipPath>
              <image xlink:href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/395186/wine.svg" x="0" y="0" width="100%" height="100%"></image>
              <g class="glass-fill" clip-path="url(#wine-clippath)">
                <rect x="10" y="20" width="31" height="120" style="fill: #874640;"></rect>
                <rect x="40" y="20" width="21" height="120" style="fill: #AA6F65;"></rect>
                <rect x="60" y="20" width="21" height="120" style="fill: #874640;"></rect>
                <rect x="80" y="20" width="70" height="120" style="fill: #751D19;"></rect>
              </g>
            </svg>
            <h2><%= investment.match %> %</h2>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div class="group-block w-100">
    <h2 class='group-title'>Votre liste de souhaits</h2>
    <div class="cards-top">
       <% @investments.each do |investment| %>
        <div class="card-top">
          <div>
            <%= cl_image_tag investment.photo.key, height: 100, width: 150, crop: :fill if investment.photo.attached? %>
          </div>
          <div class="card-top-infos">
            <div class="card-top-text">
              <h2><%= investment.investment_name %></h2>
              <p><%= investment.region %></p>
              <p><%= investment.designation %></p>
            </div>
          </div>
          <div class="card-top-pricing">
            <h2><%= investment.match %> %</h2>
            <h2>Ticket : <%= investment.ticket_amount %> €</h2>
            <h2>Inv total : <%= investment.investment_total %> €</h2>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="container">
  <hr>
  <%= link_to "Rejoindre ce groupe", join_request_group_users_groups_path(@group), class: 'btn btn-primary', method: :post %>
  <hr>

  <h4>Inviter des personnes à rejoindre le groupe</h4>

  <div class="form-group d-flex align-items-center">

  <% available_users = User.all.to_a %>
  <% available_users.reject! {|u| u.id == @group.user_id } %>
  <% available_users.reject! {|u| u.in? @group.users } %>

  <%= form_tag(invite_group_users_groups_path(@group), style: 'width: 100%;') do %>
    <%= select_tag "user_ids", options_from_collection_for_select(available_users, "id", "email"), multiple: true, class: 'form-control select2', style: "width: 100%;" %>
    <%= submit_tag "inviter", class: "btn-invest-first btn-invest-test" %>
  <% end %>
  </div>

  <hr>
   <table class="table table-bordered">
    <h3>Membres de mon groupe / Investisseurs</h3>
    <thead>
      <tr>
        <th scope="col">avatar</th>
        <th scope="col">Nom / Prénom</th>
        <th scope="col">email</th>
        <th scope="col">apport</th>
        <th scope="col">statut</th>
        <th scope="col">statut</th>
      </tr>
    </thead>

  <% @group.users_groups.each do |groupuser|  %>
      <tbody>
        <tr>
          <td><small class="text-muted">Avatar:</small> <%= image_tag(groupuser.user.avatar, class:"avatar-large-invest")  %> </td>
          <td><small class="text-muted">Par:</small> <%= groupuser.user.first_name  %> <strong><%= groupuser.user.last_name  %></strong>  </td>
          <td><small class="text-muted">Coordonnées:</small>  <%= groupuser.user.email %> </td>
          <td><small class="text-muted">Apport:</small>   <%= @group.ticket_amount  %> €</td>
          <td><small class="text-muted">Statut:</small>   <%= groupuser.status  %></td>
          <td><small class="text-muted"></small>
            <% if groupuser.status == "pending" %>
             <%= link_to confirm_users_group_path(groupuser), method: :patch do  %>
               <button class="btn btn-outline-danger w-100">Confirmer</button>

            <% end %>
            <% else %>
            <%= "Confirmé" %>
            <% end %>
          </td>
    <% end %>
  </table>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"></script>

<script>
  document.querySelectorAll('svg[data-size]').forEach((svg) => {
    const size = svg.dataset.size;
    const tl = new TimelineMax();
    const rects = svg.querySelectorAll('rect');
    tl.to(rects, 0.4, { scaleY: size, transformOrigin: '50% 100%' });
  })
</script>

</body>
